<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Tableau de Bord</ion-title>
    <ion-buttons slot="end">
      <ion-button id="notifications-trigger">
        <ion-icon name="notifications-outline" slot="icon-only"></ion-icon>
        <ion-badge color="danger" *ngIf="unreadMessages > 0">{{ unreadMessages }}</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-popover trigger="notifications-trigger" triggerAction="click" dismissOnSelect="true">
  <ng-template>
    <ion-content class="ion-padding">
      <ion-list class="notif">
        <ion-list-header>
          <ion-label>Notifications</ion-label>
        </ion-list-header>
        <ion-item *ngFor="let message of messages" (click)="markAsRead(message)">
          <ion-label>
            <h3>{{ message.title }}</h3>
            <p>{{ message.content }}</p>
            <p class="timestamp">{{ message.timestamp | date:'short' }}</p>
          </ion-label>
          <ion-icon name="mail-unread-outline" slot="end" *ngIf="!message.read"></ion-icon>
        </ion-item>
        <ion-item *ngIf="messages.length === 0">
          <ion-label>Aucun message</ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-popover>

<ion-content class="ion-padding">
  <h1 class="page-title animate__animated animate__fadeInUp">Bienvenue, {{ userName }}</h1>

  <!-- Quick Stats Cards -->
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="4">
        <ion-card class="card animate__animated animate__zoomIn">
          <ion-card-header>
            <ion-icon name="people-outline" slot="start"></ion-icon>
            <ion-card-title>Enfants Parrainés</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <h2>{{ statistics.children }}</h2>
            <p>Enfants actuellement pris en charge</p>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size="12" size-md="4">
        <ion-card class="card animate__animated animate__zoomIn" style="animation-delay: 0.2s;">
          <ion-card-header>
            <ion-icon name="cash-outline" slot="start"></ion-icon>
            <ion-card-title>Fonds Reçus</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <h2>{{ statistics.totalFunds | number }} FCFA</h2>
            <p>Total des contributions ce mois-ci</p>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size="12" size-md="4">
        <ion-card class="card animate__animated animate__zoomIn" style="animation-delay: 0.4s;">
          <ion-card-header>
            <ion-icon name="people-outline" slot="start"></ion-icon>
            <ion-card-title>Nombre Total d'Enfants</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <h2>{{ statistics.children }}</h2>
            <p>Total des enfants parrainés</p>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Statistics Charts -->
  <ion-card class="card animate__animated animate__zoomIn">
    <ion-card-header>
      <ion-icon name="bar-chart-outline" slot="start"></ion-icon>
      <ion-card-title>Statistiques Mensuelles</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6">
            <h3>Enfants Parrainés (par mois)</h3>
            <canvas
              baseChart
              id="dashboard-children-chart"
              [data]="barChartData"
              [options]="barChartOptions"
              [type]="barChartType"
              class="chart-canvas">
            </canvas>
          </ion-col>
          <ion-col size="12" size-md="6">
            <h3>Fonds Reçus (par mois)</h3>
            <canvas
              baseChart
              id="dashboard-funds-chart"
              [data]="lineChartData"
              [options]="lineChartOptions"
              [type]="lineChartType"
              class="chart-canvas">
            </canvas>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Quick Actions -->
  <ion-card class="card animate__animated animate__zoomIn" style="animation-delay: 0.6s;">
    <ion-card-header>
      <ion-icon name="flash-outline" slot="start"></ion-icon>
      <ion-card-title>Actions Rapides</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="12">
            <ion-button expand="block" color="primary" routerLink="/children/add" (click)="showToast('Ajout d\'enfant lancé !')">Ajouter un Enfant</ion-button>
          </ion-col>
          <ion-col size="12">
            <ion-button expand="block" color="secondary" routerLink="/payments/add" (click)="showToast('Enregistrement de paiement lancé !')">Enregistrer un Paiement</ion-button>
          </ion-col>
          <ion-col size="12">
            <ion-button expand="block" color="tertiary" routerLink="/reports/generate" (click)="showToast('Génération de rapport lancée !')">Générer un Rapport</ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
</ion-content>