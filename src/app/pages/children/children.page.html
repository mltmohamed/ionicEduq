<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Gestion des Enfants</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <h1 class="page-title animate__animated animate__fadeInUp">
    Gestion des Enfants Enregistrés
  </h1>

  <!-- Search Bar and Filter -->
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="6">
        <ion-searchbar
          placeholder="Rechercher un enfant"
          (ionInput)="searchChildren($event)"
          class="animate__animated animate__fadeIn">
        </ion-searchbar>
      </ion-col>
      <ion-col size="12" size-md="6">
        <ion-select
          placeholder="Filtrer par statut"
          (ionChange)="filterChildren($event)"
          class="animate__animated animate__fadeIn">
          <ion-select-option value="all">Tous</ion-select-option>
          <ion-select-option value="sponsored">Parrainés</ion-select-option>
          <ion-select-option value="non-sponsored">Non Parrainés</ion-select-option>
        </ion-select>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Add Child Button -->
  <ion-button
    color="primary"
    routerLink="/children/add"
    class="animate__animated animate__bounceIn">
    Ajouter un Enfant
  </ion-button>

  <!-- Children List -->
  <ion-card class="card animate__animated animate__zoomIn">
    <ion-card-content>
      <ion-list>
        <ion-item
          *ngFor="let child of filteredChildren; let i = index"
          (click)="openChildDetail(child)"
          lines="full"
          class="animate__animated animate__fadeIn"
          [style.animation-delay]="i * 0.1 + 's'">
          <ion-avatar slot="start">
            <img
              [src]="child.photoUrl"
              alt="Photo de {{ child.firstName }} {{ child.lastName }}"
              onerror="this.src='assets/images/child-placeholder.jpg'">
          </ion-avatar>
          <ion-label>
            <h2>{{ child.firstName }} {{ child.lastName }}</h2>
            <p>Niveau: {{ child.grade }}</p>
            <p>Statut: {{ child.status === 'active' ? 'Actif' : 'Inactif' }}</p>
            <p>Parrainé: {{ child.sponsored ? 'Oui' : 'Non' }}</p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button
              color="primary"
              (click)="editChild(child.id); $event.stopPropagation()">
              Modifier
            </ion-button>
            <ion-button
              color="warning"
              (click)="toggleStatus(child.id, child.status); $event.stopPropagation()">
              {{ child.status === 'active' ? 'Désactiver' : 'Activer' }}
            </ion-button>
            <ion-button
              color="secondary"
              (click)="markAttendance(child.id); $event.stopPropagation()">
              Présence
            </ion-button>
          </ion-buttons>
        </ion-item>

        <ion-item *ngIf="filteredChildren.length === 0">
          <ion-label>Aucun enfant trouvé</ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
<ion-modal [isOpen]="isChildDetailOpen" (didDismiss)="onChildDetailDismiss()" swipeToClose="true" presentingElement="ion-app">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Détails de l'Enfant</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="onChildDetailDismiss()">Fermer</ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content class="ion-padding" fullscreen>
    <ion-card *ngIf="selectedChild" class="detail-card">
      <ion-card-content>
        <ion-avatar class="detail-avatar">
          <img [src]="selectedChild.photoUrl" 
               alt="Photo de {{ selectedChild.firstName }} {{ selectedChild.lastName }}" 
               onerror="this.src='assets/images/child-placeholder.jpg'">
        </ion-avatar>
        <h2 class="ion-text-center">{{ selectedChild.firstName }} {{ selectedChild.lastName }}</h2>

        <ion-list lines="full">
          <ion-item><ion-label>Prénom: <strong>{{ selectedChild.firstName }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Nom: <strong>{{ selectedChild.lastName }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Âge: <strong>{{ selectedChild.age }} ans</strong></ion-label></ion-item>
          <ion-item><ion-label>Établissement Scolaire: <strong>{{ selectedChild.school }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Niveau Scolaire: <strong>{{ selectedChild.grade }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Email École: <strong>{{ selectedChild.schoolEmail }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Nom du Titulaire: <strong>{{ selectedChild.guardianName }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Numéro du Titulaire: <strong>{{ selectedChild.guardianPhone }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Email du Titulaire: <strong>{{ selectedChild.guardianEmail }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Parrainé: <strong>{{ selectedChild.sponsored ? 'Oui' : 'Non' }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Statut: <strong>{{ selectedChild.status === 'active' ? 'Actif' : 'Inactif' }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Présences: <strong>{{ selectedChild.presenceCount }}</strong></ion-label></ion-item>
          <ion-item><ion-label>Absences: <strong>{{ selectedChild.absenceCount }}</strong></ion-label></ion-item>
          <ion-item lines="none">
            <ion-label class="story-label">
              Petite Histoire:
              <p>{{ selectedChild.story }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </ion-content>
</ion-modal>

</ion-content>
